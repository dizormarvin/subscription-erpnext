{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2022-07-21 17:16:20.621538",
 "css": ".bill-container {\n    display: flex;\n    flex-direction: column;\n}\n\n.print-format {\n    max-width: 10.3in !important;\n}\n\nthead {\n    display: table-row-group;\n    background-color: #eee;     \n}\n\n.head {\n    font-weight: bold;\n}\n\n.last-row {\n    border: 2px solid;\n}\n\n@media screen {\n    .print-format {\n        min-width: 1133px;\n        margin-left: -170px;\n    }\n}",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Monthly PSOF",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "html": "<div class=\"bill-container\">\n    <div class=\"head\">\n        <div class=\"head-left\">\n            CABLE BOSS<br>\n            BILLING REPORT IN PHP<br>\n            For the Month of {{ doc.subscription_period }}\n        </div>\n    </div>\n    \n    <table class=\"table-bordered bill-table\">\n        <thead>\n            <tr class=\"head\">\n                <td>SA NO.</td>\n                <td colspan=2>CABLE SYSTEM</td>\n                <td>@{{ doc.exchange_rate }}</td>\n                <td>ASSISTANT</td>\n                <td>AE</td>\n                <td colspan=7>CUSTOMER #</td>\n            </tr>\n            <tr class=\"head\">\n                <td>ITEM CLASS</td>\n                <td>PROMO</td>\n                <td>PROGRAM</td>\n                <td style=\"white-space: nowrap;\">PSOF NO.</td>\n                <td>AMOUNT</td>\n                <td>VAT</td>\n                <td>IRD</td>\n                <td>CARD</td>\n                <td>PROMO</td>\n                <td>FREIGHT</td>\n                <td>TOTAL</td>\n            </tr>\n        </thead>\n        <tbody>\n            {% set summary = [] %}\n            {% for bill in doc.billings %}\n            {% set subs_bill = frappe.db.get_all('Subscription Bill Item', {'parent': bill.bill_no, 'subscription_period': doc.name}, \n            ['psof_no', 'subscription_program as program', 'ROUND(subscription_fee, 2) as sfee', \n            'decoder_rate_vat as dvat', 'card_rate_vat as cvat', 'promo_rate_vat as pvat', 'freight_rate_vat as fvat', 'item_class as class', 'vat', 'total_alloc_vat',\n            'computed_vat_ex as xamount']) %}\n            {% set asst = frappe.get_doc(\"Customer\", bill.customer) %}\n                <tr>\n                    <td>{{ bill.bill_no }}</td>\n                    <td style=\"white-space: nowrap;\" colspan=2>{{ bill.customer_name }}</td>\n                    <td></td>\n                    <td style=\"white-space: nowrap;\">{{ asst.nick_name }}</td>\n                    <td style=\"white-space: nowrap;\">{{ bill.account_manager or \"-\" }}</td>\n                    <td colspan=7>{{ bill.customer or \"-\" }}</td>\n                </tr>\n                {% for sub in subs_bill %}\n                    <tr>\n                        <td style=\"display: none\">{{ summary.append(sub) }}</td>\n                        <td>{{ sub.class or 'N/A' }}</td>\n                        <td>{{ sub.program if sub.class == 'PACKAGE' else '' }}</td>\n                        <td>{{ sub.program if sub.class != 'PACKAGE' else '' }}</td>\n                        <td style=\"white-space: nowrap;\" >{{ sub.psof_no }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(sub.xamount) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(sub.vat) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format((sub.dvat or 0)) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format((sub.cvat or 0)) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format((sub.pvat or 0)) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format((sub.fvat or 0)) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(sub.sfee) }}</td>\n                    </tr>\n                        {% if loop.last %}\n                        <tr class=\"last-row text-right\">\n                                <td class=\"head\" colspan=\"4\">TOTAL</td>\n                                <td>{{ \"{:,.2f}\".format(bill.computed_vat_ex or 0) }}</td>\n                                <td>{{ \"{:,.2f}\".format(bill.usd_vat or 0) }}</td>\n                                <td>{{ \"{:,.2f}\".format(bill.usd_decoder or 0) }}</td>\n                                <td>{{ \"{:,.2f}\".format(bill.usd_card or 0) }}</td>\n                                <td>{{ \"{:,.2f}\".format(bill.usd_promo or 0) }}</td>\n                                <td>{{ \"{:,.2f}\".format(bill.usd_freight or 0) }}</td>\n                                <td>{{ \"{:,.2f}\".format(bill.usd_msf or 0) }}</td>\n                            </tr>\n                        {% endif %}\n                    {% endfor %}\n            {% endfor %}\n        </tbody>\n    </table>\n    \n    <div>\n        <div class=\"head\">SUMMARY:</div>\n        <table style=\"width: -webkit-fill-available;\">\n                <tr class=\"head\">\n                    <td style=\"width:100px\">No. Systems</td>\n                    <td>PROMO</td>\n                    <td>PROGRAM</td>\n                    <td></td>\n                    <td>AMOUNT</td>\n                    <td>VAT</td>\n                    <td>IRD</td>\n                    <td>CARD</td>\n                    <td>PROMO</td>\n                    <td>FREIGHT</td>\n                    <td>TOTAL</td>\n                </tr>\n                {% set bill_summary = frappe.get_all('Subscription Bill Item', \n                filters={'subscription_period': doc.name}, \n                fields=['COUNT(subscription_program) as count', 'subscription_program as program', 'ROUND(SUM(decoder_rate_vat), 2) as dvat',\n                'ROUND(SUM(card_rate_vat), 2) as cvat', 'ROUND(SUM(promo_rate_vat), 2) as pvat', 'ROUND(SUM(freight_rate_vat), 2) as fvat',\n                'ROUND(SUM(ROUND((subscription_fee - total_alloc_vat) / 1.12, 2)), 2) as amount', 'ROUND(SUM(ROUND(subscription_rate_ex, 2)),2) as xamount', 'ROUND(SUM(ROUND(vat, 2)), 2) as vat',\n                'ROUND(SUM(ROUND(subscription_fee ,2)), 2) as stotal', 'ROUND(SUM((ROUND(decoder_rate_vat, 2) + ROUND(promo_rate_vat, 2) +\n        ROUND(card_rate_vat, 2) + ROUND(freight_rate_vat, 2) + ROUND((subscription_fee - total_alloc_vat) / 1.12, 2)\n           + ROUND(((subscription_fee - total_alloc_vat) / 1.12) * 0.12, 2))), 2) as totals', 'item_class as class'], group_by='subscription_program', order_by='subscription_program') %}\n                \n                {% for bill in bill_summary %}\n                {% set ttotal = bill.stotal - [bill.xamount, bill.vat, bill.dvat, bill.cvat, bill.pvat, bill.fvat] | sum %}\n                    <tr>\n                        <td>{{ bill.count }} {{ bill.class }}</td>\n                        <td>{{ bill.program if bill.class == 'PACKAGE' else '' }}</td>\n                        <td>{{ bill.program if bill.class in ['REGULAR', None, ''] else '' }}</td>\n                        <td></td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.xamount + ttotal) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.vat) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.dvat) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.cvat) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.pvat) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.fvat) }}</td>\n                        <td class=\"text-right\">{{ \"{:,.2f}\".format(bill.stotal) }}</td>\n                    </tr>\n                    {% if loop.last %}\n                       {% set grand_totals = frappe.db.get_list('Subscription Bill Item', {'subscription_period': doc.subscription_period}, \n                            ['ROUND(SUM((ROUND(decoder_rate_vat, 2) + ROUND(promo_rate_vat, 2) +\n        ROUND(card_rate_vat, 2) + ROUND(freight_rate_vat, 2) + ROUND((subscription_fee - total_alloc_vat) / 1.12, 2)\n           + ROUND(((subscription_fee - total_alloc_vat) / 1.12) * 0.12, 2))), 2) as totals', 'SUM(decoder_rate_vat) as dvat', 'SUM(card_rate_vat) as cvat', 'SUM(promo_rate_vat) as pvat', 'SUM(freight_rate_vat) as fvat',\n                            'SUM(ROUND(subscription_fee ,2)) as stotal', 'SUM(ROUND((subscription_fee - total_alloc_vat) / 1.12, 2)) as amount', 'SUM(ROUND(vat, 2)) as vat', 'SUM(ROUND(subscription_rate_ex, 2)) as xamount']) %}\n                            {% for total in grand_totals %}\n                            {% set fttotal = total.stotal - [total.xamount, total.vat, total.dvat, total.cvat, total.pvat, total.fvat] | sum %}\n                    <tr class=\"text-right\">\n                        <td></td>\n                        <td></td>\n                        <td></td>\n                        <td class=\"head\">GRAND TOTAL</td>\n                        <td>{{\"{:,.2f}\".format(total.xamount + fttotal) }}</td>\n                        <td>{{\"{:,.2f}\".format(total.vat) }}</td>\n                        <td>{{\"{:,.2f}\".format(total.dvat) }}</td>\n                        <td>{{\"{:,.2f}\".format(total.cvat) }}</td>\n                        <td>{{\"{:,.2f}\".format(total.pvat) }}</td>\n                        <td>{{\"{:,.2f}\".format(total.fvat) }}</td>\n                        <td>{{\"{:,.2f}\".format(total.stotal) }}</td>\n                    </tr>\n                        {% endfor %}\n                    {% endif %}\n                {% endfor %}\n        </table>\n    </div>\n</div>",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2022-07-26 09:26:24.623683",
 "modified_by": "Administrator",
 "module": "Subscription",
 "name": "Monthly Sales Summary",
 "owner": "Administrator",
 "print_format_builder": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}